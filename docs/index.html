<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Michael News</title>
  <style>
    :root { --fg:#111; --muted:#666; --card:#fff; --bg:#f6f7fb; --border:#e7e8ee; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, "PingFang SC","Hiragino Sans GB","Microsoft YaHei", Arial, sans-serif;
           background:var(--bg); color:var(--fg); }
    .wrap { max-width: 980px; margin: 28px auto; padding: 0 18px; }
    h1 { margin: 0 0 8px; font-size: 34px; letter-spacing: .2px; }
    .meta { color: var(--muted); margin-bottom: 18px; }
    .card { background: var(--card); border:1px solid var(--border); border-radius: 14px; padding: 18px; margin: 14px 0; }
    .topline { color: var(--muted); font-size: 13px; margin-bottom: 10px; }
    .title { font-size: 20px; font-weight: 750; line-height: 1.35; margin: 0 0 10px; }
    .title a { color: inherit; text-decoration: none; }
    .title a:hover { text-decoration: underline; }
    .p { margin: 0; line-height: 1.75; font-size: 15px; }
    .zh { color: var(--muted); }
    .btn { display:inline-block; margin-top: 12px; font-size: 13px; color: #0b57d0; text-decoration:none; }
    .btn:hover { text-decoration: underline; }
    .empty { color: var(--muted); padding: 28px 0; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>ğŸ“° Michael News</h1>
    <div class="meta" id="siteMeta">åŠ è½½ä¸­...</div>

    <div id="list"></div>
    <div class="empty" id="empty" style="display:none;">æš‚æ— æ•°æ®ï¼ˆå¯èƒ½ Actions è¿˜æ²¡è·‘å®Œï¼‰ã€‚</div>
  </div>

<script>
  async function loadJSON(path) {
    const r = await fetch(path, { cache: "no-store" });
    if (!r.ok) throw new Error("Fetch failed: " + path);
    return await r.json();
  }

  function esc(s) {
    return (s ?? "").toString()
      .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
      .replaceAll('"',"&quot;").replaceAll("'","&#39;");
  }

  function withZh(orig, zh) {
    const o = esc(orig || "");
    const z = esc(zh || "");
    if (z) return `${o} <span class="zh">ï¼ˆ${z}ï¼‰</span>`;
    return `${o} <span class="zh">ï¼ˆæœªç¿»è¯‘ï¼‰</span>`;
  }

  (async () => {
    try {
      const [meta, news] = await Promise.all([
        loadJSON("./site_meta.json"),
        loadJSON("./news.json")
      ]);

      document.getElementById("siteMeta").innerText =
        `æœ€åæ›´æ–°ï¼š${meta.last_updated} ï½œ å…± ${meta.count} æ¡`;

      const list = document.getElementById("list");
      if (!Array.isArray(news) || news.length === 0) {
        document.getElementById("empty").style.display = "block";
        return;
      }

      list.innerHTML = news.map(item => {
        const source = esc(item.source || "");
        const published = esc(item.published || "");
        const link = esc(item.link || "#");

        const titleHTML = withZh(item.title_orig, item.title_zh);
        const summaryOrig = item.summary_orig || "";
        const summaryZh = item.summary_zh || "";

        const summaryHTML = summaryOrig
          ? `<p class="p">${withZh(summaryOrig, summaryZh)}</p>`
          : `<p class="p"><span class="zh">ï¼ˆæœªæå–åˆ°ç¬¬ä¸€æ®µï¼‰</span></p>`;

        return `
          <div class="card">
            <div class="topline">${source} Â· ${published}</div>
            <div class="title">
              <a href="${link}" target="_blank" rel="noreferrer">${titleHTML}</a>
            </div>
            ${summaryHTML}
            <a class="btn" href="${link}" target="_blank" rel="noreferrer">æ‰“å¼€åŸæ–‡ â†’</a>
          </div>
        `;
      }).join("");
    } catch (e) {
      document.getElementById("siteMeta").innerText = "åŠ è½½å¤±è´¥ï¼šè¯·ç¨ååˆ·æ–°ï¼ˆå¯èƒ½æ–‡ä»¶è¿˜æ²¡ç”Ÿæˆï¼‰";
      document.getElementById("empty").style.display = "block";
      console.error(e);
    }
  })();
</script>
</body>
</html>
